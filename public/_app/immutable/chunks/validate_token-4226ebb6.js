import{b as s}from"./basic_provider-9b5e3560.js";import{u as g}from"./user_store-5372ed67.js";import{u as h}from"./client-5fc005f9.js";function u(e){this.message=e}u.prototype=new Error,u.prototype.name="InvalidCharacterError";var l=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(e){var o=String(e).replace(/=+$/,"");if(o.length%4==1)throw new u("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,t,r=0,a=0,i="";t=o.charAt(a++);~t&&(n=r%4?64*n+t:t,r++%4)?i+=String.fromCharCode(255&n>>(-2*r&6)):0)t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(t);return i};function w(e){var o=e.replace(/-/g,"+").replace(/_/g,"/");switch(o.length%4){case 0:break;case 2:o+="==";break;case 3:o+="=";break;default:throw"Illegal base64url string!"}try{return function(n){return decodeURIComponent(l(n).replace(/(.)/g,function(t,r){var a=r.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a}))}(o)}catch{return l(o)}}function d(e){this.message=e}function v(e,o){if(typeof e!="string")throw new d("Invalid token specified");var n=(o=o||{}).header===!0?0:1;try{return JSON.parse(w(e.split(".")[n]))}catch(t){throw new d("Invalid token specified: "+t.message)}}d.prototype=new Error,d.prototype.name="InvalidTokenError";function p(){s.update(()=>({token:"",business:void 0,user:void 0,users:[],valid:!1,clientAddresses:[],business_address:void 0,default_pickup_location:void 0,default_delivery_location:void 0,bookings:[],quotes:[]})),g.update(()=>({token:"",user:void 0}))}async function m(){var n;debugger;let e=document.cookie.split("login_guard=")[1];if(e==null||e=="")return p(),!1;let o;try{o=v(e)}catch{return p(),!1}if((o.exp<Date.now()/1e3||e==null||e==null||e=="")&&e!=""&&e!=null)try{let t=await h.post("validate",{token:e});return((n=t==null?void 0:t.data)==null?void 0:n.success)==!0?(s.update(r=>{var a,i,c,f;return r&&(r.token=(i=(a=t==null?void 0:t.data)==null?void 0:a.body)==null?void 0:i.token,r.user=(f=(c=t==null?void 0:t.data)==null?void 0:c.body)==null?void 0:f.user,r)}),!0):!1}catch{return s.update(r=>r&&(r.token="",r.user=void 0,r)),!1}return!0}export{m as v};
